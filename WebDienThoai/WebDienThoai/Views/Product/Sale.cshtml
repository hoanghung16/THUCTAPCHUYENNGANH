@model IEnumerable<WebDienThoai.Models.Product>
@{
    ViewData["Title"] = "Săn Sale Giá Sốc";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="page-header">
    <div class="container">
        <h1>Ưu Đãi Đặc Biệt</h1>
        <ul class="breadcrumb">
            <li><a href="/">Trang chủ</a></li>
            <li>Khuyến mãi</li>
        </ul>
    </div>
</section>

<section class="flash-sale-section mb-5">
    <div class="container">
        <div class="flash-sale-banner">
            <div class="content">
                <h2>⚡ FLASH SALE ⚡</h2>
                <p>Cơ hội sở hữu siêu phẩm với giá không tưởng. Kết thúc sau:</p>
                <div id="countdown" class="countdown-timer">
                    <div class="time-box">
                        <span id="hours">00</span>
                        <small>Giờ</small>
                    </div>
                    <div class="time-box">
                        <span id="minutes">00</span>
                        <small>Phút</small>
                    </div>
                    <div class="time-box">
                        <span id="seconds">00</span>
                        <small>Giây</small>
                    </div>
                </div>
            </div>
            <div class="image">
                <img src="~/img/10.jpg" alt="Flash Sale" style="opacity: 0.8; mix-blend-mode: luminosity;">
            </div>
        </div>
    </div>
</section>

<section class="section pt-0">
    <div class="container">

        <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded shadow-sm">
            <h4 class="m-0 fw-bold" style="color: var(--sale-color);">
                <i class="bi bi-fire me-2"></i>Đang giảm giá (@(Model?.Count() ?? 0))
            </h4>

            <div class="d-flex align-items-center">
                <label class="me-2 text-nowrap text-muted">Sắp xếp:</label>
                <select id="sale-sort-select" class="form-select form-select-sm" style="width: 180px;">
                    <option value="default">Mặc định</option>
                    <option value="price-asc">Giá thấp đến cao</option>
                    <option value="price-desc">Giá cao đến thấp</option>
                    <option value="discount-desc">% Giảm nhiều nhất</option>
                </select>
            </div>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="grid" id="sale-product-grid" style="grid-template-columns: repeat(4, 1fr); gap: 30px;">
                @foreach (var item in Model)
                {
                    // Tính toán % giảm giá
                    decimal original = item.Price;
                    decimal sale = item.Saleprice ?? item.Price;
                    int percent = 0;
                    if (original > 0 && sale < original)
                    {
                        percent = (int)Math.Round((1 - (sale / original)) * 100);
                    }

                    <div class="product-card h-100 d-flex flex-column"
                         style="background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee;"
                         data-price="@sale"
                         data-discount="@percent">

                        <a asp-controller="Product" asp-action="Detail" asp-route-id="@item.Id" class="d-block text-center mb-3">
                            <img src="@item.ImageUrl" alt="@item.Name" style="height: 200px; width: 100%; object-fit: contain;">
                        </a>

                        <p class="product-name fw-bold mb-2 text-dark" style="min-height: 48px;">
                            @item.Name
                        </p>

                        <div class="price-container mb-3">
                            <span class="text-muted text-decoration-line-through me-2 small">@original.ToString("N0")đ</span>
                            <span class="text-danger fw-bold fs-5">@sale.ToString("N0")đ</span>
                        </div>

                        <div class="sale-badge" style="background-color: var(--sale-color); font-size: 13px;">
                            -@percent%
                        </div>

                        <a asp-controller="Product" asp-action="Detail" asp-route-id="@item.Id"
                           class="btn w-100 mt-auto fw-bold text-uppercase py-2 cta-button"
                           style="color: white; border: none;">
                            Săn Ngay
                        </a>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <img src="https://cdn-icons-png.flaticon.com/512/2038/2038854.png" alt="No Sale" style="width: 100px; opacity: 0.5; margin-bottom: 20px;">
                <h3 class="text-muted">Hiện chưa có chương trình khuyến mãi nào.</h3>
                <a asp-controller="Home" asp-action="Index" class="cta-button mt-3">Quay về trang chủ</a>
            </div>
        }
    </div>
</section>

<style>
    /* Flash Sale Banner */
    .flash-sale-banner {
        background-color: #222; /* Nền tối sang trọng */
        border-radius: 12px;
        display: flex;
        overflow: hidden;
        position: relative;
        color: white;
        margin-top: -30px; /* Đẩy lên đè nhẹ vào header nếu muốn */
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

        .flash-sale-banner .content {
            padding: 40px;
            flex: 1;
            z-index: 2;
        }

        .flash-sale-banner h2 {
            font-size: 36px;
            font-weight: 800;
            color: var(--accent-color-1); /* Màu vàng cát */
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .flash-sale-banner .image {
            flex: 1;
            background: linear-gradient(to right, #222, transparent); /* Fade ảnh vào nền */
            position: relative;
        }

            .flash-sale-banner .image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

    /* Countdown Timer Style */
    .countdown-timer {
        display: flex;
        gap: 15px;
        margin-top: 25px;
    }

    .time-box {
        background: rgba(255,255,255,0.1);
        border: 1px solid var(--accent-color-1);
        padding: 10px 15px;
        border-radius: 8px;
        text-align: center;
        min-width: 80px;
    }

        .time-box span {
            display: block;
            font-size: 24px;
            font-weight: bold;
            color: white;
            line-height: 1;
        }

        .time-box small {
            font-size: 11px;
            text-transform: uppercase;
            color: #aaa;
        }

    /* Responsive */
    @@media (max-width: 768px) {
        .flash-sale-banner {
            flex-direction: column;
        }

            .flash-sale-banner .image {
                height: 200px;
                display: none;
            }
        /* Ẩn ảnh trên mobile */
        .grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
</style>

@section Scripts {
    <script src="~/js/pages/sale.js"></script>
}