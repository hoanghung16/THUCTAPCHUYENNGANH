@model WebDienThoai.ViewModels.ShopViewModel

@{
    ViewData["Title"] = "Cửa Hàng - THE KING";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="page-header">
    <div class="container">
        <h1>Cửa Hàng Trực Tuyến</h1>
        <ul class="breadcrumb">
            <li><a href="/">Trang chủ</a></li>
            <li>Sản phẩm</li>
        </ul>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="row">

            <div class="col-md-3">
                <div class="filter-sidebar p-4 mb-4 bg-light rounded shadow-sm">

                    <h5 class="fw-bold mb-3 text-uppercase border-bottom pb-2">Danh Mục</h5>
                    <div class="mb-4">
                        <select class="form-select" onchange="window.location.href=this.value">
                            <option value="@Url.Action("Shop", new { categorySlug = "all", priceRange = Model.CurrentPriceRange, sort = Model.CurrentSort })"
                                    selected="@(Model.CurrentCategory == "all")">
                                Tất cả sản phẩm
                            </option>
                            @foreach (var cat in Model.Categories)
                            {
                                <option value="@Url.Action("Shop", new { categorySlug = cat.Slug ?? cat.Name, priceRange = Model.CurrentPriceRange, sort = Model.CurrentSort })"
                                        selected="@(Model.CurrentCategory == (cat.Slug ?? cat.Name))">
                                    @cat.Name
                                </option>
                            }
                        </select>
                    </div>

                    <h5 class="fw-bold mt-4 mb-3 text-uppercase border-bottom pb-2">Mức Giá</h5>
                    <ul class="list-unstyled">
                        @{
                            var prices = new Dictionary<string, string> {
                                                {"all", "Tất cả mức giá"},
                                                {"under-5", "Dưới 5 triệu"},
                                                {"5-15", "Từ 5 - 15 triệu"},
                                                {"15-25", "Từ 15 - 25 triệu"},
                                                {"over-25", "Trên 25 triệu"}
                                                };
                        }
                        @foreach (var price in prices)
                        {
                            <li class="mb-2">
                                <a href="@Url.Action("Shop", new { categorySlug = Model.CurrentCategory, priceRange = price.Key, sort = Model.CurrentSort })"
                                   class="text-decoration-none @(Model.CurrentPriceRange == price.Key ? "fw-bold text-danger" : "text-dark")">
                                    <i class="bi @(Model.CurrentPriceRange == price.Key ? "bi-check-circle-fill" : "bi-circle") me-2"></i>@price.Value
                                </a>
                            </li>
                        }
                    </ul>

                    @if (Model.CurrentCategory != "all" || Model.CurrentPriceRange != "all")
                    {
                        <div class="mt-4 pt-3 border-top">
                            <a href="@Url.Action("Shop")" class="btn btn-outline-secondary w-100 btn-sm">Xóa bộ lọc</a>
                        </div>
                    }
                </div>
            </div>

            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded shadow-sm">
                    <span class="text-muted">Trang <strong>@Model.CurrentPage</strong> / @Model.TotalPages</span>
                    <form method="get" action="@Url.Action("Shop")" class="d-flex align-items-center">
                        <input type="hidden" name="categorySlug" value="@Model.CurrentCategory" />
                        <input type="hidden" name="priceRange" value="@Model.CurrentPriceRange" />
                        <label class="me-2 text-nowrap">Sắp xếp:</label>
                        <select name="sort" class="form-select form-select-sm" style="width: 160px;" onchange="this.form.submit()">
                            <!option value="default" @(Model.CurrentSort == "default" ? "selected" : "")>Mới nhất</!option>
                            <!option value="price_asc" @(Model.CurrentSort == "price_asc" ? "selected" : "")>Giá tăng dần</!option>
                            <!option value="price_desc" @(Model.CurrentSort == "price_desc" ? "selected" : "")>Giá giảm dần</!option>
                        </select>
                    </form>
                </div>

                <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 30px;">
                    @if (Model.Products.Any())
                    {
                        @foreach (var product in Model.Products)
                        {
                            
                            <div class="product-card h-100 d-flex flex-column" style="background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee;">
                                <a asp-controller="Product" asp-action="Detail" asp-route-id="@product.Id" class="d-block text-center mb-3">
                                    <img src="@product.ImageUrl" alt="@product.Name" style="height: 200px; width: 100%; object-fit: contain;">
                                </a>
                                <p class="product-name fw-bold mb-2 text-dark" style="min-height: 48px;">@product.Name</p>

                                @if (product.IsOnSale)
                                {
                                    <div class="price-container mb-3">
                                        <span class="text-muted text-decoration-line-through me-2 small">@product.Price.ToString("N0")đ</span>
                                        <span class="text-danger fw-bold fs-5">@((product.Saleprice ?? 0).ToString("N0"))đ</span>
                                    </div>
                                    <div class="sale-badge">SALE</div>
                                }
                                else
                                {
                                    <div class="price-container mb-3">
                                        <p class="fw-bold fs-5 mb-0 text-dark">@product.Price.ToString("N0")đ</p>
                                    </div>
                                }
                                <a asp-controller="Product" asp-action="Detail" asp-route-id="@product.Id" class="btn w-100 mt-auto fw-bold text-uppercase py-2 cta-button" style="color: white; border: none;">Chi tiết</a>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-12 text-center text-muted py-5">Không tìm thấy sản phẩm.</div>
                    }
                </div>

                @if (Model.TotalPages > 1)
                {
                    <nav aria-label="Page navigation" class="mt-5">
                        <ul class="pagination justify-content-center">
                            @for (int i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Shop", new { page = i, categorySlug = Model.CurrentCategory, priceRange = Model.CurrentPriceRange, sort = Model.CurrentSort })">@i</a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/pages/category.js"></script>
}