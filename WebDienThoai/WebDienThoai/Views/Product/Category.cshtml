@model IEnumerable<WebDienThoai.Models.Product>
@{
    ViewData["Title"] = ViewData["CategoryName"];
}

<div class="bg-light py-4 mb-4">
    <div class="container">
        <h2 class="fw-bold text-uppercase mb-0">@ViewData["CategoryName"]</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 mt-2">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-decoration-none text-muted">Trang chủ</a></li>
                <li class="breadcrumb-item active" aria-current="page">@ViewData["CategoryName"]</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container pb-5">
    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white fw-bold py-3">
                    <i class="bi bi-funnel me-2"></i> BỘ LỌC TÌM KIẾM
                </div>
                <div class="card-body">
                    <h6 class="fw-bold mb-3">Khoảng giá</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="price-filter" id="price-all" value="all" checked>
                        <label class="form-check-label" for="price-all">Tất cả mức giá</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="price-filter" id="price-1" value="under-5">
                        <label class="form-check-label" for="price-1">Dưới 5 triệu</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="price-filter" id="price-2" value="5-15">
                        <label class="form-check-label" for="price-2">Từ 5 - 15 triệu</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="price-filter" id="price-3" value="15-25">
                        <label class="form-check-label" for="price-3">Từ 15 - 25 triệu</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="price-filter" id="price-4" value="over-25">
                        <label class="form-check-label" for="price-4">Trên 25 triệu</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded shadow-sm border">
                <span class="text-muted" id="result-count">Hiển thị @Model.Count() sản phẩm</span>

                <div class="d-flex align-items-center">
                    <label class="me-2 text-nowrap">Sắp xếp:</label>
                    <select class="form-select form-select-sm" id="sort-select">
                        <option value="default">Mặc định</option>
                        <option value="price-asc">Giá tăng dần</option>
                        <option value="price-desc">Giá giảm dần</option>
                        <option value="name-asc">Tên A-Z</option>
                    </select>
                </div>
            </div>

            <div class="row row-cols-2 row-cols-md-3 g-4" id="product-grid">
                @foreach (var product in Model)
                {
                    // Logic tính giá hiển thị
                    decimal finalPrice = product.IsOnSale && product.Saleprice.HasValue ? product.Saleprice.Value : product.Price;

                    <div class="col product-item" data-name="@product.Name">
                        <span class="product-price-value d-none" data-value="@finalPrice"></span>

                        <div class="card h-100 border-0 shadow-sm product-card-hover">
                            @if (product.IsOnSale)
                            {
                                <div class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 m-2 rounded fw-bold z-1 small">
                                    Giảm giá
                                </div>
                            }

                            <div class="card-img-wrapper overflow-hidden bg-light p-4 text-center position-relative" style="height: 220px; display:flex; align-items:center; justify-content:center;">
                                <a asp-controller="Product" asp-action="Detail" asp-route-id="@product.Id">
                                    <img src="@product.ImageUrl" class="img-fluid" alt="@product.Name" style="max-height: 100%; object-fit: contain; transition: transform 0.3s ease;">
                                </a>
                            </div>

                            <div class="card-body d-flex flex-column text-center">
                                <div class="mb-1 text-muted small text-uppercase">@product.Category?.Name</div>
                                <h6 class="card-title text-truncate">
                                    <a asp-controller="Product" asp-action="Detail" asp-route-id="@product.Id" class="text-dark text-decoration-none stretched-link">
                                        @product.Name
                                    </a>
                                </h6>

                                <div class="mt-auto">
                                    @if (product.IsOnSale && product.Saleprice.HasValue)
                                    {
                                        <span class="text-muted text-decoration-line-through small me-1">@product.Price.ToString("N0")đ</span>
                                        <span class="text-danger fw-bold">@product.Saleprice.Value.ToString("N0")đ</span>
                                    }
                                    else
                                    {
                                        <span class="fw-bold">@product.Price.ToString("N0")đ</span>
                                    }
                                </div>

                                <div class="mt-3 position-relative" style="z-index: 2;">
                                    <form asp-controller="Cart" asp-action="AddToCart" method="post">
                                        <input type="hidden" name="id" value="@product.Id" />
                                        <button type="submit" class="btn btn-outline-dark btn-sm w-100 rounded-pill">
                                            Chọn mua
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/category.js"></script>
}

<style>
    .product-card-hover {
        transition: all 0.3s ease;
    }

        .product-card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }

            .product-card-hover:hover img {
                transform: scale(1.05);
            }
</style>